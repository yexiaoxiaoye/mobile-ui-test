<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SVG和预设颜色测试</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }

      .test-container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .test-section {
        margin-bottom: 30px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }

      .test-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 15px 0;
      }

      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }

      button:hover {
        background: #0056b3;
      }

      .demo-area {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 600px;
        background: #f0f0f0;
        border-radius: 8px;
        margin: 20px 0;
      }

      .test-result {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 10px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
      }

      .feature-list {
        list-style: none;
        padding: 0;
      }

      .feature-list li {
        padding: 8px 0;
        border-bottom: 1px solid #eee;
      }

      .feature-list li:before {
        content: '✅ ';
        color: green;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>🎨 SVG图标和预设颜色系统测试</h1>

      <div class="test-section">
        <h3>🎯 修改内容</h3>
        <ul class="feature-list">
          <li>删除WiFi图标，只保留信号和电量图标</li>
          <li>预设颜色简化为黑色和白色</li>
          <li>添加用户自定义预设颜色功能</li>
          <li>支持添加和删除自定义预设</li>
          <li>自定义预设持久化保存</li>
        </ul>
      </div>

      <div class="test-section">
        <h3>🎮 测试功能</h3>
        <div class="test-controls">
          <button onclick="openThemeEditor()">打开主题编辑器</button>
          <button onclick="testSVGIcons()">测试SVG图标</button>
          <button onclick="testPresetColors()">测试预设颜色</button>
          <button onclick="testAddCustomColor()">测试添加自定义预设</button>
          <button onclick="testDeleteCustomColor()">测试删除自定义预设</button>
          <button onclick="testExportImport()">测试导出导入</button>
          <button onclick="runAllTests()">🔄 运行全部测试</button>
        </div>
      </div>

      <div class="test-section">
        <h3>📊 测试结果</h3>
        <div id="testResults" class="test-result">等待测试开始...</div>
      </div>

      <div class="test-section">
        <h3>📱 手机界面演示</h3>
        <div class="demo-area" id="demoArea">
          <!-- 手机界面将在这里显示 -->
        </div>
      </div>
    </div>

    <!-- 加载必要的文件 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="styles/phone-shell.css" />
    <link rel="stylesheet" href="styles/phone-interface.css" />
    <link rel="stylesheet" href="styles/wallpaper-app.css" />
    <script src="apps/phone-shell.js"></script>
    <script src="apps/phone-interface.js"></script>
    <script src="apps/wallpaper-app.js"></script>

    <script>
      let testResults = [];

      function log(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = `[${timestamp}] ${message}`;
        testResults.push({ message: logEntry, type });
        updateTestResults();
        console.log(message);
      }

      function updateTestResults() {
        const resultsDiv = document.getElementById('testResults');
        resultsDiv.innerHTML = testResults
          .map(
            result =>
              `<div style="color: ${result.type === 'error' ? 'red' : result.type === 'success' ? 'green' : 'black'}">${
                result.message
              }</div>`,
          )
          .join('');
        resultsDiv.scrollTop = resultsDiv.scrollHeight;
      }

      // 打开主题编辑器
      function openThemeEditor() {
        log('🔄 打开主题编辑器...', 'info');

        if (window.WallpaperApp) {
          window.WallpaperApp.setEditType('phone');
          window.WallpaperApp.switchMode('theme');
          window.WallpaperApp.show();
          log('✅ 主题编辑器已打开', 'success');
        } else {
          log('❌ WallpaperApp未加载', 'error');
        }
      }

      // 测试SVG图标
      function testSVGIcons() {
        log('🔄 测试SVG图标...', 'info');

        const $phone = $('#phone_interface');
        if ($phone.length > 0) {
          const $svg = $phone.find('.phone-shell-status-icons svg');
          if ($svg.length > 0) {
            const svgContent = $svg.html();
            const hasWifi = svgContent.includes('WiFi') || svgContent.includes('wifi');
            const hasSignal = svgContent.includes('signal') || svgContent.includes('path');
            const hasBattery = svgContent.includes('battery') || svgContent.includes('rect');

            log(`📊 SVG内容检查:`, 'info');
            log(`  - 包含WiFi图标: ${hasWifi}`, hasWifi ? 'error' : 'success');
            log(`  - 包含信号图标: ${hasSignal}`, hasSignal ? 'success' : 'error');
            log(`  - 包含电池图标: ${hasBattery}`, hasBattery ? 'success' : 'error');

            if (!hasWifi && hasSignal && hasBattery) {
              log('✅ SVG图标测试通过：WiFi已删除，信号和电池保留', 'success');
            } else {
              log('❌ SVG图标测试失败', 'error');
            }
          } else {
            log('❌ 找不到SVG图标元素', 'error');
          }
        } else {
          log('❌ 找不到手机界面元素', 'error');
        }
      }

      // 测试预设颜色
      function testPresetColors() {
        log('🔄 测试预设颜色...', 'info');

        openThemeEditor();

        setTimeout(() => {
          const borderColors = $('.border-color-section .color-option:not(.add-color-option)');
          const iconColors = $('.icon-color-section .color-option:not(.add-color-option)');

          log(`📊 预设颜色数量:`, 'info');
          log(`  - 边框颜色预设: ${borderColors.length}个`, 'info');
          log(`  - 图标颜色预设: ${iconColors.length}个`, 'info');

          // 检查是否只有基础颜色（黑白）
          const borderColorNames = [];
          const iconColorNames = [];

          borderColors.each(function () {
            const name = $(this).find('.color-name').text();
            borderColorNames.push(name);
          });

          iconColors.each(function () {
            const name = $(this).find('.color-name').text();
            iconColorNames.push(name);
          });

          log(`  - 边框颜色名称: ${borderColorNames.join(', ')}`, 'info');
          log(`  - 图标颜色名称: ${iconColorNames.join(', ')}`, 'info');

          // 检查添加按钮
          const addBorderBtn = $('.border-color-section .add-color-option');
          const addIconBtn = $('.icon-color-section .add-color-option');

          if (addBorderBtn.length > 0 && addIconBtn.length > 0) {
            log('✅ 添加预设按钮存在', 'success');
          } else {
            log('❌ 添加预设按钮缺失', 'error');
          }

          if (borderColors.length <= 4 && iconColors.length <= 4) {
            log('✅ 预设颜色数量合理（基础预设+少量自定义）', 'success');
          } else {
            log('⚠️ 预设颜色数量较多，可能包含过多预设', 'info');
          }
        }, 1000);
      }

      // 测试添加自定义预设
      function testAddCustomColor() {
        log('🔄 测试添加自定义预设...', 'info');

        if (window.WallpaperApp) {
          // 先设置一个颜色，然后添加为预设
          const testColor = '#ff6b6b';

          // 应用颜色
          window.WallpaperApp.applyColorConfig('border', testColor);

          setTimeout(() => {
            // 验证颜色已应用
            const currentConfig = window.WallpaperApp.getCurrentThemeConfig();
            log(`当前边框颜色: ${currentConfig.borderColor}`, 'info');

            if (currentConfig.borderColor === testColor) {
              log('✅ 测试颜色已应用', 'success');

              // 添加为自定义预设
              const success = window.WallpaperApp.addCustomColor('border', testColor, '测试红色', '测试用的红色边框');

              if (success) {
                log('✅ 自定义边框颜色添加成功', 'success');

                // 检查是否保存到localStorage
                const saved = localStorage.getItem('customColors_border');
                if (saved) {
                  const customColors = JSON.parse(saved);
                  const hasTestColor = customColors.some(c => c.value === testColor);
                  if (hasTestColor) {
                    log('✅ 自定义颜色已保存到localStorage', 'success');
                  } else {
                    log('❌ 自定义颜色未保存到localStorage', 'error');
                  }
                }
              } else {
                log('❌ 自定义边框颜色添加失败', 'error');
              }
            } else {
              log('❌ 测试颜色未正确应用', 'error');
            }
          }, 500);
        } else {
          log('❌ WallpaperApp未加载', 'error');
        }
      }

      // 测试删除自定义预设
      function testDeleteCustomColor() {
        log('🔄 测试删除自定义预设...', 'info');

        if (window.WallpaperApp) {
          // 先添加一个测试颜色
          const testColor = '#4ecdc4';
          window.WallpaperApp.addCustomColor('icon', testColor, '测试青色', '测试用的青色图标');

          setTimeout(() => {
            // 然后删除它
            const success = window.WallpaperApp.removeCustomColor('icon', testColor);

            if (success) {
              log('✅ 自定义图标颜色删除成功', 'success');

              // 检查是否从localStorage中删除
              const saved = localStorage.getItem('customColors_icon');
              if (saved) {
                const customColors = JSON.parse(saved);
                const hasTestColor = customColors.some(c => c.value === testColor);
                if (!hasTestColor) {
                  log('✅ 自定义颜色已从localStorage中删除', 'success');
                } else {
                  log('❌ 自定义颜色未从localStorage中删除', 'error');
                }
              }
            } else {
              log('❌ 自定义图标颜色删除失败', 'error');
            }
          }, 200);
        } else {
          log('❌ WallpaperApp未加载', 'error');
        }
      }

      // 测试导出导入功能
      function testExportImport() {
        log('🔄 测试导出导入功能...', 'info');

        if (window.WallpaperApp) {
          // 先添加一些测试数据
          const testBorderColor = '#ff6b6b';
          const testIconColor = '#4ecdc4';

          // 应用测试颜色
          window.WallpaperApp.applyColorConfig('border', testBorderColor);
          window.WallpaperApp.applyColorConfig('icon', testIconColor);

          setTimeout(() => {
            // 添加自定义预设
            window.WallpaperApp.addCustomColor('border', testBorderColor, '测试红色边框', '导出导入测试用');
            window.WallpaperApp.addCustomColor('icon', testIconColor, '测试青色图标', '导出导入测试用');

            setTimeout(() => {
              // 模拟导出
              const exportData = {
                currentWallpaper: window.WallpaperApp.currentWallpaper,
                history: window.WallpaperApp.wallpaperHistory,
                qqBackgrounds: window.WallpaperApp.qqBackgrounds,
                themeConfig: window.WallpaperApp.getCurrentThemeConfig(),
                customColors: {
                  border: window.WallpaperApp.getCustomColors('border'),
                  icon: window.WallpaperApp.getCustomColors('icon'),
                },
              };

              log('📁 模拟导出数据:', 'info');
              log(`  - 主题配置: ${JSON.stringify(exportData.themeConfig)}`, 'info');
              log(`  - 自定义边框预设: ${exportData.customColors.border.length}个`, 'info');
              log(`  - 自定义图标预设: ${exportData.customColors.icon.length}个`, 'info');

              // 检查导出数据完整性
              if (
                exportData.themeConfig &&
                exportData.customColors &&
                exportData.customColors.border.length > 0 &&
                exportData.customColors.icon.length > 0
              ) {
                log('✅ 导出数据完整性检查通过', 'success');
                log('✅ 导出导入功能测试成功', 'success');
              } else {
                log('❌ 导出数据不完整', 'error');
              }
            }, 500);
          }, 500);
        } else {
          log('❌ WallpaperApp未加载', 'error');
        }
      }

      // 运行全部测试
      function runAllTests() {
        testResults = [];
        log('🚀 开始运行全部测试...', 'info');

        setTimeout(() => testSVGIcons(), 500);
        setTimeout(() => testPresetColors(), 1500);
        setTimeout(() => testAddCustomColor(), 3000);
        setTimeout(() => testDeleteCustomColor(), 4500);
        setTimeout(() => testExportImport(), 6000);

        setTimeout(() => {
          log('🎉 全部测试完成！', 'success');
        }, 8000);
      }

      // 页面加载完成后初始化
      $(document).ready(function () {
        log('页面加载完成，开始初始化...', 'info');

        // 检查必要的组件是否加载
        if (typeof window.PhoneShell === 'undefined') {
          log('❌ PhoneShell未加载', 'error');
          return;
        }

        if (typeof window.PhoneInterface === 'undefined') {
          log('❌ PhoneInterface未加载', 'error');
          return;
        }

        if (typeof window.WallpaperApp === 'undefined') {
          log('❌ WallpaperApp未加载', 'error');
          return;
        }

        // 初始化组件
        window.PhoneShell.init();
        window.PhoneInterface.initButtonOnly();
        window.WallpaperApp.init();

        log('✅ 所有组件初始化完成', 'success');

        // 创建测试手机界面
        const testContent = `
                <div style="padding: 20px; text-align: center; color: #666;">
                    <h3>SVG和预设颜色测试</h3>
                    <p>验证图标修改和自定义预设功能</p>
                    <p>点击上方按钮进行各项测试</p>
                </div>
            `;

        const phoneHTML = window.PhoneShell.createShellHTML(testContent, 'test_phone');
        $('#demoArea').html(phoneHTML);

        // 显示手机界面
        window.PhoneShell.show('test_phone');

        log('📱 测试手机界面已创建', 'success');
        log('✅ 测试环境初始化完成，可以开始测试', 'success');
        log('💡 提示：点击"打开主题编辑器"查看新的预设颜色系统', 'info');
      });
    </script>
  </body>
</html>
