<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SVGå’Œé¢„è®¾é¢œè‰²æµ‹è¯•</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }

      .test-container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .test-section {
        margin-bottom: 30px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }

      .test-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 15px 0;
      }

      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }

      button:hover {
        background: #0056b3;
      }

      .demo-area {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 600px;
        background: #f0f0f0;
        border-radius: 8px;
        margin: 20px 0;
      }

      .test-result {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 10px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
      }

      .feature-list {
        list-style: none;
        padding: 0;
      }

      .feature-list li {
        padding: 8px 0;
        border-bottom: 1px solid #eee;
      }

      .feature-list li:before {
        content: 'âœ… ';
        color: green;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>ğŸ¨ SVGå›¾æ ‡å’Œé¢„è®¾é¢œè‰²ç³»ç»Ÿæµ‹è¯•</h1>

      <div class="test-section">
        <h3>ğŸ¯ ä¿®æ”¹å†…å®¹</h3>
        <ul class="feature-list">
          <li>åˆ é™¤WiFiå›¾æ ‡ï¼Œåªä¿ç•™ä¿¡å·å’Œç”µé‡å›¾æ ‡</li>
          <li>é¢„è®¾é¢œè‰²ç®€åŒ–ä¸ºé»‘è‰²å’Œç™½è‰²</li>
          <li>æ·»åŠ ç”¨æˆ·è‡ªå®šä¹‰é¢„è®¾é¢œè‰²åŠŸèƒ½</li>
          <li>æ”¯æŒæ·»åŠ å’Œåˆ é™¤è‡ªå®šä¹‰é¢„è®¾</li>
          <li>è‡ªå®šä¹‰é¢„è®¾æŒä¹…åŒ–ä¿å­˜</li>
        </ul>
      </div>

      <div class="test-section">
        <h3>ğŸ® æµ‹è¯•åŠŸèƒ½</h3>
        <div class="test-controls">
          <button onclick="openThemeEditor()">æ‰“å¼€ä¸»é¢˜ç¼–è¾‘å™¨</button>
          <button onclick="testSVGIcons()">æµ‹è¯•SVGå›¾æ ‡</button>
          <button onclick="testPresetColors()">æµ‹è¯•é¢„è®¾é¢œè‰²</button>
          <button onclick="testAddCustomColor()">æµ‹è¯•æ·»åŠ è‡ªå®šä¹‰é¢„è®¾</button>
          <button onclick="testDeleteCustomColor()">æµ‹è¯•åˆ é™¤è‡ªå®šä¹‰é¢„è®¾</button>
          <button onclick="testExportImport()">æµ‹è¯•å¯¼å‡ºå¯¼å…¥</button>
          <button onclick="runAllTests()">ğŸ”„ è¿è¡Œå…¨éƒ¨æµ‹è¯•</button>
        </div>
      </div>

      <div class="test-section">
        <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
        <div id="testResults" class="test-result">ç­‰å¾…æµ‹è¯•å¼€å§‹...</div>
      </div>

      <div class="test-section">
        <h3>ğŸ“± æ‰‹æœºç•Œé¢æ¼”ç¤º</h3>
        <div class="demo-area" id="demoArea">
          <!-- æ‰‹æœºç•Œé¢å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
      </div>
    </div>

    <!-- åŠ è½½å¿…è¦çš„æ–‡ä»¶ -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="styles/phone-shell.css" />
    <link rel="stylesheet" href="styles/phone-interface.css" />
    <link rel="stylesheet" href="styles/wallpaper-app.css" />
    <script src="apps/phone-shell.js"></script>
    <script src="apps/phone-interface.js"></script>
    <script src="apps/wallpaper-app.js"></script>

    <script>
      let testResults = [];

      function log(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = `[${timestamp}] ${message}`;
        testResults.push({ message: logEntry, type });
        updateTestResults();
        console.log(message);
      }

      function updateTestResults() {
        const resultsDiv = document.getElementById('testResults');
        resultsDiv.innerHTML = testResults
          .map(
            result =>
              `<div style="color: ${result.type === 'error' ? 'red' : result.type === 'success' ? 'green' : 'black'}">${
                result.message
              }</div>`,
          )
          .join('');
        resultsDiv.scrollTop = resultsDiv.scrollHeight;
      }

      // æ‰“å¼€ä¸»é¢˜ç¼–è¾‘å™¨
      function openThemeEditor() {
        log('ğŸ”„ æ‰“å¼€ä¸»é¢˜ç¼–è¾‘å™¨...', 'info');

        if (window.WallpaperApp) {
          window.WallpaperApp.setEditType('phone');
          window.WallpaperApp.switchMode('theme');
          window.WallpaperApp.show();
          log('âœ… ä¸»é¢˜ç¼–è¾‘å™¨å·²æ‰“å¼€', 'success');
        } else {
          log('âŒ WallpaperAppæœªåŠ è½½', 'error');
        }
      }

      // æµ‹è¯•SVGå›¾æ ‡
      function testSVGIcons() {
        log('ğŸ”„ æµ‹è¯•SVGå›¾æ ‡...', 'info');

        const $phone = $('#phone_interface');
        if ($phone.length > 0) {
          const $svg = $phone.find('.phone-shell-status-icons svg');
          if ($svg.length > 0) {
            const svgContent = $svg.html();
            const hasWifi = svgContent.includes('WiFi') || svgContent.includes('wifi');
            const hasSignal = svgContent.includes('signal') || svgContent.includes('path');
            const hasBattery = svgContent.includes('battery') || svgContent.includes('rect');

            log(`ğŸ“Š SVGå†…å®¹æ£€æŸ¥:`, 'info');
            log(`  - åŒ…å«WiFiå›¾æ ‡: ${hasWifi}`, hasWifi ? 'error' : 'success');
            log(`  - åŒ…å«ä¿¡å·å›¾æ ‡: ${hasSignal}`, hasSignal ? 'success' : 'error');
            log(`  - åŒ…å«ç”µæ± å›¾æ ‡: ${hasBattery}`, hasBattery ? 'success' : 'error');

            if (!hasWifi && hasSignal && hasBattery) {
              log('âœ… SVGå›¾æ ‡æµ‹è¯•é€šè¿‡ï¼šWiFiå·²åˆ é™¤ï¼Œä¿¡å·å’Œç”µæ± ä¿ç•™', 'success');
            } else {
              log('âŒ SVGå›¾æ ‡æµ‹è¯•å¤±è´¥', 'error');
            }
          } else {
            log('âŒ æ‰¾ä¸åˆ°SVGå›¾æ ‡å…ƒç´ ', 'error');
          }
        } else {
          log('âŒ æ‰¾ä¸åˆ°æ‰‹æœºç•Œé¢å…ƒç´ ', 'error');
        }
      }

      // æµ‹è¯•é¢„è®¾é¢œè‰²
      function testPresetColors() {
        log('ğŸ”„ æµ‹è¯•é¢„è®¾é¢œè‰²...', 'info');

        openThemeEditor();

        setTimeout(() => {
          const borderColors = $('.border-color-section .color-option:not(.add-color-option)');
          const iconColors = $('.icon-color-section .color-option:not(.add-color-option)');

          log(`ğŸ“Š é¢„è®¾é¢œè‰²æ•°é‡:`, 'info');
          log(`  - è¾¹æ¡†é¢œè‰²é¢„è®¾: ${borderColors.length}ä¸ª`, 'info');
          log(`  - å›¾æ ‡é¢œè‰²é¢„è®¾: ${iconColors.length}ä¸ª`, 'info');

          // æ£€æŸ¥æ˜¯å¦åªæœ‰åŸºç¡€é¢œè‰²ï¼ˆé»‘ç™½ï¼‰
          const borderColorNames = [];
          const iconColorNames = [];

          borderColors.each(function () {
            const name = $(this).find('.color-name').text();
            borderColorNames.push(name);
          });

          iconColors.each(function () {
            const name = $(this).find('.color-name').text();
            iconColorNames.push(name);
          });

          log(`  - è¾¹æ¡†é¢œè‰²åç§°: ${borderColorNames.join(', ')}`, 'info');
          log(`  - å›¾æ ‡é¢œè‰²åç§°: ${iconColorNames.join(', ')}`, 'info');

          // æ£€æŸ¥æ·»åŠ æŒ‰é’®
          const addBorderBtn = $('.border-color-section .add-color-option');
          const addIconBtn = $('.icon-color-section .add-color-option');

          if (addBorderBtn.length > 0 && addIconBtn.length > 0) {
            log('âœ… æ·»åŠ é¢„è®¾æŒ‰é’®å­˜åœ¨', 'success');
          } else {
            log('âŒ æ·»åŠ é¢„è®¾æŒ‰é’®ç¼ºå¤±', 'error');
          }

          if (borderColors.length <= 4 && iconColors.length <= 4) {
            log('âœ… é¢„è®¾é¢œè‰²æ•°é‡åˆç†ï¼ˆåŸºç¡€é¢„è®¾+å°‘é‡è‡ªå®šä¹‰ï¼‰', 'success');
          } else {
            log('âš ï¸ é¢„è®¾é¢œè‰²æ•°é‡è¾ƒå¤šï¼Œå¯èƒ½åŒ…å«è¿‡å¤šé¢„è®¾', 'info');
          }
        }, 1000);
      }

      // æµ‹è¯•æ·»åŠ è‡ªå®šä¹‰é¢„è®¾
      function testAddCustomColor() {
        log('ğŸ”„ æµ‹è¯•æ·»åŠ è‡ªå®šä¹‰é¢„è®¾...', 'info');

        if (window.WallpaperApp) {
          // å…ˆè®¾ç½®ä¸€ä¸ªé¢œè‰²ï¼Œç„¶åæ·»åŠ ä¸ºé¢„è®¾
          const testColor = '#ff6b6b';

          // åº”ç”¨é¢œè‰²
          window.WallpaperApp.applyColorConfig('border', testColor);

          setTimeout(() => {
            // éªŒè¯é¢œè‰²å·²åº”ç”¨
            const currentConfig = window.WallpaperApp.getCurrentThemeConfig();
            log(`å½“å‰è¾¹æ¡†é¢œè‰²: ${currentConfig.borderColor}`, 'info');

            if (currentConfig.borderColor === testColor) {
              log('âœ… æµ‹è¯•é¢œè‰²å·²åº”ç”¨', 'success');

              // æ·»åŠ ä¸ºè‡ªå®šä¹‰é¢„è®¾
              const success = window.WallpaperApp.addCustomColor('border', testColor, 'æµ‹è¯•çº¢è‰²', 'æµ‹è¯•ç”¨çš„çº¢è‰²è¾¹æ¡†');

              if (success) {
                log('âœ… è‡ªå®šä¹‰è¾¹æ¡†é¢œè‰²æ·»åŠ æˆåŠŸ', 'success');

                // æ£€æŸ¥æ˜¯å¦ä¿å­˜åˆ°localStorage
                const saved = localStorage.getItem('customColors_border');
                if (saved) {
                  const customColors = JSON.parse(saved);
                  const hasTestColor = customColors.some(c => c.value === testColor);
                  if (hasTestColor) {
                    log('âœ… è‡ªå®šä¹‰é¢œè‰²å·²ä¿å­˜åˆ°localStorage', 'success');
                  } else {
                    log('âŒ è‡ªå®šä¹‰é¢œè‰²æœªä¿å­˜åˆ°localStorage', 'error');
                  }
                }
              } else {
                log('âŒ è‡ªå®šä¹‰è¾¹æ¡†é¢œè‰²æ·»åŠ å¤±è´¥', 'error');
              }
            } else {
              log('âŒ æµ‹è¯•é¢œè‰²æœªæ­£ç¡®åº”ç”¨', 'error');
            }
          }, 500);
        } else {
          log('âŒ WallpaperAppæœªåŠ è½½', 'error');
        }
      }

      // æµ‹è¯•åˆ é™¤è‡ªå®šä¹‰é¢„è®¾
      function testDeleteCustomColor() {
        log('ğŸ”„ æµ‹è¯•åˆ é™¤è‡ªå®šä¹‰é¢„è®¾...', 'info');

        if (window.WallpaperApp) {
          // å…ˆæ·»åŠ ä¸€ä¸ªæµ‹è¯•é¢œè‰²
          const testColor = '#4ecdc4';
          window.WallpaperApp.addCustomColor('icon', testColor, 'æµ‹è¯•é’è‰²', 'æµ‹è¯•ç”¨çš„é’è‰²å›¾æ ‡');

          setTimeout(() => {
            // ç„¶ååˆ é™¤å®ƒ
            const success = window.WallpaperApp.removeCustomColor('icon', testColor);

            if (success) {
              log('âœ… è‡ªå®šä¹‰å›¾æ ‡é¢œè‰²åˆ é™¤æˆåŠŸ', 'success');

              // æ£€æŸ¥æ˜¯å¦ä»localStorageä¸­åˆ é™¤
              const saved = localStorage.getItem('customColors_icon');
              if (saved) {
                const customColors = JSON.parse(saved);
                const hasTestColor = customColors.some(c => c.value === testColor);
                if (!hasTestColor) {
                  log('âœ… è‡ªå®šä¹‰é¢œè‰²å·²ä»localStorageä¸­åˆ é™¤', 'success');
                } else {
                  log('âŒ è‡ªå®šä¹‰é¢œè‰²æœªä»localStorageä¸­åˆ é™¤', 'error');
                }
              }
            } else {
              log('âŒ è‡ªå®šä¹‰å›¾æ ‡é¢œè‰²åˆ é™¤å¤±è´¥', 'error');
            }
          }, 200);
        } else {
          log('âŒ WallpaperAppæœªåŠ è½½', 'error');
        }
      }

      // æµ‹è¯•å¯¼å‡ºå¯¼å…¥åŠŸèƒ½
      function testExportImport() {
        log('ğŸ”„ æµ‹è¯•å¯¼å‡ºå¯¼å…¥åŠŸèƒ½...', 'info');

        if (window.WallpaperApp) {
          // å…ˆæ·»åŠ ä¸€äº›æµ‹è¯•æ•°æ®
          const testBorderColor = '#ff6b6b';
          const testIconColor = '#4ecdc4';

          // åº”ç”¨æµ‹è¯•é¢œè‰²
          window.WallpaperApp.applyColorConfig('border', testBorderColor);
          window.WallpaperApp.applyColorConfig('icon', testIconColor);

          setTimeout(() => {
            // æ·»åŠ è‡ªå®šä¹‰é¢„è®¾
            window.WallpaperApp.addCustomColor('border', testBorderColor, 'æµ‹è¯•çº¢è‰²è¾¹æ¡†', 'å¯¼å‡ºå¯¼å…¥æµ‹è¯•ç”¨');
            window.WallpaperApp.addCustomColor('icon', testIconColor, 'æµ‹è¯•é’è‰²å›¾æ ‡', 'å¯¼å‡ºå¯¼å…¥æµ‹è¯•ç”¨');

            setTimeout(() => {
              // æ¨¡æ‹Ÿå¯¼å‡º
              const exportData = {
                currentWallpaper: window.WallpaperApp.currentWallpaper,
                history: window.WallpaperApp.wallpaperHistory,
                qqBackgrounds: window.WallpaperApp.qqBackgrounds,
                themeConfig: window.WallpaperApp.getCurrentThemeConfig(),
                customColors: {
                  border: window.WallpaperApp.getCustomColors('border'),
                  icon: window.WallpaperApp.getCustomColors('icon'),
                },
              };

              log('ğŸ“ æ¨¡æ‹Ÿå¯¼å‡ºæ•°æ®:', 'info');
              log(`  - ä¸»é¢˜é…ç½®: ${JSON.stringify(exportData.themeConfig)}`, 'info');
              log(`  - è‡ªå®šä¹‰è¾¹æ¡†é¢„è®¾: ${exportData.customColors.border.length}ä¸ª`, 'info');
              log(`  - è‡ªå®šä¹‰å›¾æ ‡é¢„è®¾: ${exportData.customColors.icon.length}ä¸ª`, 'info');

              // æ£€æŸ¥å¯¼å‡ºæ•°æ®å®Œæ•´æ€§
              if (
                exportData.themeConfig &&
                exportData.customColors &&
                exportData.customColors.border.length > 0 &&
                exportData.customColors.icon.length > 0
              ) {
                log('âœ… å¯¼å‡ºæ•°æ®å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡', 'success');
                log('âœ… å¯¼å‡ºå¯¼å…¥åŠŸèƒ½æµ‹è¯•æˆåŠŸ', 'success');
              } else {
                log('âŒ å¯¼å‡ºæ•°æ®ä¸å®Œæ•´', 'error');
              }
            }, 500);
          }, 500);
        } else {
          log('âŒ WallpaperAppæœªåŠ è½½', 'error');
        }
      }

      // è¿è¡Œå…¨éƒ¨æµ‹è¯•
      function runAllTests() {
        testResults = [];
        log('ğŸš€ å¼€å§‹è¿è¡Œå…¨éƒ¨æµ‹è¯•...', 'info');

        setTimeout(() => testSVGIcons(), 500);
        setTimeout(() => testPresetColors(), 1500);
        setTimeout(() => testAddCustomColor(), 3000);
        setTimeout(() => testDeleteCustomColor(), 4500);
        setTimeout(() => testExportImport(), 6000);

        setTimeout(() => {
          log('ğŸ‰ å…¨éƒ¨æµ‹è¯•å®Œæˆï¼', 'success');
        }, 8000);
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      $(document).ready(function () {
        log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...', 'info');

        // æ£€æŸ¥å¿…è¦çš„ç»„ä»¶æ˜¯å¦åŠ è½½
        if (typeof window.PhoneShell === 'undefined') {
          log('âŒ PhoneShellæœªåŠ è½½', 'error');
          return;
        }

        if (typeof window.PhoneInterface === 'undefined') {
          log('âŒ PhoneInterfaceæœªåŠ è½½', 'error');
          return;
        }

        if (typeof window.WallpaperApp === 'undefined') {
          log('âŒ WallpaperAppæœªåŠ è½½', 'error');
          return;
        }

        // åˆå§‹åŒ–ç»„ä»¶
        window.PhoneShell.init();
        window.PhoneInterface.initButtonOnly();
        window.WallpaperApp.init();

        log('âœ… æ‰€æœ‰ç»„ä»¶åˆå§‹åŒ–å®Œæˆ', 'success');

        // åˆ›å»ºæµ‹è¯•æ‰‹æœºç•Œé¢
        const testContent = `
                <div style="padding: 20px; text-align: center; color: #666;">
                    <h3>SVGå’Œé¢„è®¾é¢œè‰²æµ‹è¯•</h3>
                    <p>éªŒè¯å›¾æ ‡ä¿®æ”¹å’Œè‡ªå®šä¹‰é¢„è®¾åŠŸèƒ½</p>
                    <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¿›è¡Œå„é¡¹æµ‹è¯•</p>
                </div>
            `;

        const phoneHTML = window.PhoneShell.createShellHTML(testContent, 'test_phone');
        $('#demoArea').html(phoneHTML);

        // æ˜¾ç¤ºæ‰‹æœºç•Œé¢
        window.PhoneShell.show('test_phone');

        log('ğŸ“± æµ‹è¯•æ‰‹æœºç•Œé¢å·²åˆ›å»º', 'success');
        log('âœ… æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•', 'success');
        log('ğŸ’¡ æç¤ºï¼šç‚¹å‡»"æ‰“å¼€ä¸»é¢˜ç¼–è¾‘å™¨"æŸ¥çœ‹æ–°çš„é¢„è®¾é¢œè‰²ç³»ç»Ÿ', 'info');
      });
    </script>
  </body>
</html>
