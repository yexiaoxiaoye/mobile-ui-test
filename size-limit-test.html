<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>手机界面尺寸限制测试</title>
    
    <!-- 引入jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/phone-interface.css">
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .test-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .test-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .test-subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .test-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            min-width: 280px;
        }
        
        .panel-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .panel-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .section-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 13px;
        }
        
        .info-label {
            color: #666;
        }
        
        .info-value {
            color: #007bff;
            font-weight: bold;
        }
        
        .test-btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #ff9ad5 0%, #a88beb 100%);
            color: white;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 8px;
            transition: transform 0.2s ease;
        }
        
        .test-btn:hover {
            transform: translateY(-1px);
        }
        
        .size-comparison {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }
        
        .comparison-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .size-demo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .size-box {
            width: 20px;
            height: 40px;
            border: 2px solid #007bff;
            border-radius: 4px;
            position: relative;
        }
        
        .size-box.original {
            background: rgba(0, 123, 255, 0.2);
        }
        
        .size-box.scaled {
            background: rgba(255, 154, 213, 0.3);
            border-color: #ff9ad5;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-indicator.good {
            background: #28a745;
        }
        
        .status-indicator.warning {
            background: #ffc107;
        }
        
        .status-indicator.info {
            background: #17a2b8;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <div class="test-title">📏 手机界面尺寸限制测试</div>
        <div class="test-subtitle">验证在大屏幕设备上的尺寸控制效果</div>
    </div>
    
    <div class="test-panel">
        <div class="panel-section">
            <div class="section-title">屏幕信息</div>
            <div class="info-row">
                <span class="info-label">窗口尺寸:</span>
                <span class="info-value" id="window_size">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">设备类型:</span>
                <span class="info-value" id="device_type">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">像素比:</span>
                <span class="info-value" id="pixel_ratio">-</span>
            </div>
        </div>
        
        <div class="panel-section">
            <div class="section-title">缩放信息</div>
            <div class="info-row">
                <span class="info-label">当前缩放:</span>
                <span class="info-value" id="current_scale">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">实际尺寸:</span>
                <span class="info-value" id="actual_size">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">限制状态:</span>
                <span class="info-value" id="limit_status">-</span>
            </div>
        </div>
        
        <div class="panel-section">
            <div class="section-title">测试操作</div>
            <button class="test-btn" onclick="togglePhone()">显示/隐藏手机</button>
            <button class="test-btn" onclick="testLargeScreen()">模拟大屏幕</button>
            <button class="test-btn" onclick="testSmallScreen()">模拟小屏幕</button>
            <button class="test-btn" onclick="resetScreen()">重置屏幕</button>
        </div>
    </div>
    
    <div class="size-comparison">
        <div class="comparison-title">尺寸对比</div>
        <div class="size-demo">
            <div class="size-box original"></div>
            <span>原始尺寸 (375×812)</span>
        </div>
        <div class="size-demo">
            <div class="size-box scaled"></div>
            <span>当前显示尺寸</span>
        </div>
        <div style="margin-top: 10px; font-size: 11px; color: #666;">
            <div><span class="status-indicator good"></span>正常缩放</div>
            <div><span class="status-indicator warning"></span>达到上限</div>
            <div><span class="status-indicator info"></span>自适应缩小</div>
        </div>
    </div>

    <!-- 引入手机界面脚本 -->
    <script src="apps/phone-interface.js"></script>
    
    <script>
        let originalWindowSize = { width: window.innerWidth, height: window.innerHeight };
        
        // 更新所有信息
        function updateAllInfo() {
            updateScreenInfo();
            updateScaleInfo();
            updateSizeComparison();
        }
        
        // 更新屏幕信息
        function updateScreenInfo() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            
            $('#window_size').text(`${width} × ${height}`);
            $('#pixel_ratio').text(window.devicePixelRatio || 1);
            
            // 判断设备类型
            let deviceType = '桌面';
            if (width <= 480) deviceType = '手机';
            else if (width <= 768) deviceType = '小平板';
            else if (width <= 1024) deviceType = '平板';
            else if (width <= 1440) deviceType = '笔记本';
            else deviceType = '大屏幕';
            
            $('#device_type').text(deviceType);
        }
        
        // 更新缩放信息
        function updateScaleInfo() {
            const $phone = $('#phone_interface');
            if ($phone.length > 0) {
                const scale = parseFloat($phone.css('--phone-scale') || '1');
                const actualWidth = Math.round(375 * scale);
                const actualHeight = Math.round(812 * scale);
                
                $('#current_scale').text(`${(scale * 100).toFixed(0)}%`);
                $('#actual_size').text(`${actualWidth} × ${actualHeight}`);
                
                // 判断限制状态
                let limitStatus = '';
                if (scale >= 1.0) {
                    limitStatus = '已达上限';
                } else if (scale >= 0.9) {
                    limitStatus = '正常显示';
                } else {
                    limitStatus = '自适应缩小';
                }
                $('#limit_status').text(limitStatus);
            } else {
                $('#current_scale').text('未初始化');
                $('#actual_size').text('-');
                $('#limit_status').text('-');
            }
        }
        
        // 更新尺寸对比
        function updateSizeComparison() {
            const $phone = $('#phone_interface');
            if ($phone.length > 0) {
                const scale = parseFloat($phone.css('--phone-scale') || '1');
                const scaledBox = $('.size-box.scaled');
                
                // 调整对比框的高度
                const newHeight = Math.round(40 * scale);
                scaledBox.css('height', `${newHeight}px`);
                
                // 更新边框颜色表示状态
                if (scale >= 1.0) {
                    scaledBox.css('border-color', '#ffc107'); // 警告色
                } else if (scale >= 0.9) {
                    scaledBox.css('border-color', '#28a745'); // 成功色
                } else {
                    scaledBox.css('border-color', '#17a2b8'); // 信息色
                }
            }
        }
        
        // 切换手机显示
        function togglePhone() {
            if (window.PhoneInterface) {
                const $phone = $('#phone_interface');
                if ($phone.hasClass('show')) {
                    window.PhoneInterface.hide();
                } else {
                    window.PhoneInterface.show();
                }
                setTimeout(updateAllInfo, 100);
            }
        }
        
        // 测试大屏幕
        function testLargeScreen() {
            simulateWindowSize(1920, 1080);
            console.log('🖥️ 模拟大屏幕: 1920×1080 - 验证尺寸限制效果');
        }
        
        // 测试小屏幕
        function testSmallScreen() {
            simulateWindowSize(375, 667);
            console.log('📱 模拟小屏幕: 375×667 - 验证自适应缩放');
        }
        
        // 重置屏幕
        function resetScreen() {
            simulateWindowSize(originalWindowSize.width, originalWindowSize.height);
            console.log('🔄 重置到原始屏幕尺寸');
        }
        
        // 模拟窗口尺寸
        function simulateWindowSize(width, height) {
            Object.defineProperty(window, 'innerWidth', {
                writable: true,
                configurable: true,
                value: width
            });
            Object.defineProperty(window, 'innerHeight', {
                writable: true,
                configurable: true,
                value: height
            });
            
            $(window).trigger('resize');
            setTimeout(updateAllInfo, 100);
        }
        
        // 页面初始化
        $(document).ready(function() {
            console.log('尺寸限制测试页面加载完成');
            
            // 保存原始窗口尺寸
            originalWindowSize = { width: window.innerWidth, height: window.innerHeight };
            
            // 初始化手机界面
            if (window.PhoneInterface) {
                window.PhoneInterface.init();
                console.log('✅ 手机界面初始化完成');
            } else {
                setTimeout(() => {
                    if (window.PhoneInterface) {
                        window.PhoneInterface.init();
                        console.log('✅ 手机界面初始化完成（延迟）');
                    }
                }, 1000);
            }
            
            // 更新信息
            updateAllInfo();
            
            // 监听窗口变化
            $(window).on('resize orientationchange', function() {
                setTimeout(updateAllInfo, 100);
            });
            
            // 定期更新
            setInterval(updateAllInfo, 3000);
        });
    </script>
</body>
</html>
