<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>èƒŒåŒ…åº”ç”¨æµ‹è¯•</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="styles/phone-shell.css" />
    <link rel="stylesheet" href="styles/phone-interface.css" />
    <link rel="stylesheet" href="styles/backpack-app.css" />
  </head>
  <body>
    <div style="padding: 20px">
      <h1>èƒŒåŒ…åº”ç”¨æµ‹è¯•é¡µé¢</h1>
      <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•èƒŒåŒ…åº”ç”¨ï¼š</p>
      <button
        id="test-backpack-btn"
        style="padding: 10px 20px; background: #f97316; color: white; border: none; border-radius: 8px; cursor: pointer"
      >
        æµ‹è¯•èƒŒåŒ…åº”ç”¨
      </button>
      <button
        id="test-phone-btn"
        style="
          padding: 10px 20px;
          background: #3b82f6;
          color: white;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          margin-left: 10px;
        "
      >
        æ˜¾ç¤ºæ‰‹æœºç•Œé¢
      </button>

      <div
        style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #3b82f6"
      >
        <h3 style="margin: 0 0 10px 0; color: #1e40af">æµ‹è¯•è¯´æ˜</h3>
        <ul style="margin: 0; color: #1e40af">
          <li>ç‚¹å‡»èƒŒåŒ…ç•Œé¢å†…éƒ¨ï¼ˆç‰©å“ã€åˆ†ç±»æ ‡ç­¾ç­‰ï¼‰åº”è¯¥<strong>ä¸ä¼š</strong>è¿”å›ä¸»é¡µ</li>
          <li>ç‚¹å‡»æ‰‹æœºå±å¹•å¤–éƒ¨åº”è¯¥å…³é—­æ‰‹æœºå¹¶è¿”å›ä¸»é¡µ</li>
          <li>ç‚¹å‡»å°æˆ¿å­æŒ‰é’®åº”è¯¥è¿”å›æ‰‹æœºä¸»é¡µ</li>
          <li>ç‚¹å‡»ç‰©å“åº”è¯¥å¼¹å‡ºä½¿ç”¨å¯¹è¯æ¡†</li>
          <li><strong>æ–°åŠŸèƒ½</strong>ï¼šåˆ†ç±»æ ‡ç­¾ä¼šæ ¹æ®å®é™…ç‰©å“ç±»å‹åŠ¨æ€ç”Ÿæˆ</li>
          <li><strong>æ–°åŠŸèƒ½</strong>ï¼šæ¯ä¸ªåˆ†ç±»æ ‡ç­¾æ˜¾ç¤ºè¯¥ç±»åˆ«çš„ç‰©å“æ•°é‡</li>
          <li><strong>æ–°åŠŸèƒ½</strong>ï¼šç‰©å“å›¾æ ‡ä¼šæ ¹æ®ç±»å‹è‡ªåŠ¨åŒ¹é…emoji</li>
          <li><strong>æ–°åŠŸèƒ½</strong>ï¼šåˆ†ç±»æ ‡ç­¾æ æ”¯æŒæ·˜å®é£æ ¼çš„ä¸æ»‘æ‹–æ‹½æ¡ï¼Œå¯ä»¥æ‹–æ‹½æˆ–ç‚¹å‡»å¿«é€Ÿæ»šåŠ¨</li>
          <li><strong>æ–°åŠŸèƒ½</strong>ï¼šæ”¯æŒ"å·²ä½¿ç”¨"ç‰©å“ç®¡ç†ï¼Œä½¿ç”¨è¿‡çš„ç‰©å“ä¼šè‡ªåŠ¨ç§»åˆ°å·²ä½¿ç”¨æ </li>
          <li><strong>æ–°åŠŸèƒ½</strong>ï¼šä½¿ç”¨ç‰©å“é¡µé¢é›†æˆåœ¨æ‰‹æœºä¸­ï¼Œä¸å†æ˜¯å¼¹çª—å½¢å¼</li>
          <li><strong>æ–°åŠŸèƒ½</strong>ï¼šæ”¯æŒé€‰æ‹©ä½¿ç”¨ç‰©å“æ•°é‡ï¼Œç²¾ç¡®ç®¡ç†ç‰©å“åº“å­˜</li>
          <li><strong>ä¿®å¤</strong>ï¼šä¿®å¤äº†èƒŒåŒ…åº”ç”¨æ— æ³•æ­£ç¡®åŠ è½½çš„é—®é¢˜</li>
          <li><strong>ä¿®å¤</strong>ï¼šä¿®å¤äº†ç‰©å“æ•°é‡ç®¡ç†é—®é¢˜ï¼Œç°åœ¨å¯ä»¥æ­£ç¡®å¤„ç†éƒ¨åˆ†ä½¿ç”¨</li>
          <li><strong>ä¿®å¤</strong>ï¼šä¿®å¤äº†ç‰©å“æ æ•°é‡ä¸å‡å°‘çš„é—®é¢˜</li>
          <li><strong>ä¿®å¤</strong>ï¼šä¿®å¤äº†å·²ä½¿ç”¨æ æ•°é‡æ˜¾ç¤ºé”™è¯¯çš„é—®é¢˜</li>
          <li><strong>ä¿®å¤</strong>ï¼šä¿®å¤äº†åˆæ¬¡è¿›å…¥èƒŒåŒ…æ˜¾ç¤ºé”™è¯¯æ ‡ç­¾é¡µçš„é—®é¢˜</li>
          <li><strong>é‡å¤§æ›´æ–°</strong>ï¼šå®ç°äº†åŸºäºèŠå¤©è®°å½•çš„æ•°æ®æŒä¹…åŒ–ï¼Œå‚è€ƒä»»åŠ¡åº”ç”¨çš„ç‚¹æ•°è®¡ç®—æ–¹å¼</li>
          <li><strong>æ–°åŠŸèƒ½</strong>ï¼šç‰©å“ä½¿ç”¨åä¼šåœ¨èŠå¤©è®°å½•ä¸­ç•™ä¸‹æ ‡å‡†æ ¼å¼çš„ä½¿ç”¨è®°å½•</li>
          <li><strong>ä¿®å¤</strong>ï¼šä¿®å¤äº†é‡æ–°æ‰“å¼€èƒŒåŒ…æ—¶æ•°é‡æ¢å¤åŸçŠ¶çš„é—®é¢˜</li>
        </ul>
      </div>

      <div
        style="margin-top: 15px; padding: 15px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #22c55e"
      >
        <h3 style="margin: 0 0 10px 0; color: #15803d">æµ‹è¯•æ•°æ®è¯´æ˜</h3>
        <p style="margin: 0; color: #15803d; font-size: 14px">
          æµ‹è¯•æ•°æ®åŒ…å«15ä¸ªç‰©å“ï¼Œåˆ†ä¸º13ä¸ªç±»åˆ«ã€‚ç°åœ¨æ”¯æŒåŸºäºèŠå¤©è®°å½•çš„æ•°æ®æŒä¹…åŒ–ï¼š
          ä½¿ç”¨ç‰©å“åä¼šåœ¨èŠå¤©è®°å½•ä¸­ç”Ÿæˆæ ‡å‡†æ ¼å¼çš„ä½¿ç”¨è®°å½•ï¼Œé‡æ–°æ‰“å¼€èƒŒåŒ…æ—¶ä¼šæ ¹æ®è¿™äº›è®°å½•
          æ­£ç¡®è®¡ç®—å‰©ä½™æ•°é‡ï¼Œå®ç°çœŸæ­£çš„æ•°æ®æŒä¹…åŒ–ã€‚
        </p>
      </div>
    </div>

    <!-- æ¨¡æ‹Ÿæ•°æ®æå–å™¨ -->
    <script>
      window.HQDataExtractor = {
        extractBackpackItems: async function () {
          // æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®åŠ è½½
          await new Promise(resolve => setTimeout(resolve, 500));

          return [
            {
              name: 'ç”Ÿå‘½è¯æ°´',
              type: 'è¯æ°´',
              count: 5,
              description: 'æ¢å¤å¤§é‡ç”Ÿå‘½å€¼çš„ç¥å¥‡è¯æ°´ï¼Œåœ¨å±é™©æ—¶åˆ»èƒ½å¤ŸæŒ½æ•‘ç”Ÿå‘½ï¼Œæ˜¯å†’é™©è€…å¿…å¤‡çš„ç‰©å“',
            },
            {
              name: 'é­”æ³•æŠ¤ç¬¦',
              type: 'è£…å¤‡',
              count: 1,
              description: 'è•´å«å¤è€é­”æ³•åŠ›é‡çš„æŠ¤ç¬¦ï¼Œèƒ½å¤Ÿæå‡ä½©æˆ´è€…çš„é­”æ³•é˜²å¾¡åŠ›å’Œæ³•æœ¯å¨åŠ›',
            },
            {
              name: 'ç²¾é’¢çŸ¿çŸ³',
              type: 'ææ–™',
              count: 12,
              description: 'ç¨€æœ‰çš„ç²¾é’¢çŸ¿çŸ³ï¼Œè´¨åœ°åšç¡¬ï¼Œæ˜¯é”»é€ é«˜çº§æ­¦å™¨å’Œé˜²å…·çš„é‡è¦ææ–™',
            },
            {
              name: 'æ—¶ç©ºå·è½´',
              type: 'å·è½´',
              count: 1,
              description: 'è®°å½•ç€æ—¶ç©ºé­”æ³•çš„ç¥ç§˜å·è½´ï¼Œä½¿ç”¨åå¯ä»¥çŸ­æš‚æ“æ§æ—¶é—´æµé€Ÿï¼Œæå…¶çè´µ',
            },
            {
              name: 'èœ‚èœœé¢åŒ…',
              type: 'é£Ÿç‰©',
              count: 8,
              description: 'é¦™ç”œå¯å£çš„èœ‚èœœé¢åŒ…ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ¢å¤ä½“åŠ›å’Œç²¾ç¥ï¼Œæ˜¯é•¿é€”æ—…è¡Œçš„ç†æƒ³é£Ÿç‰©',
            },
            {
              name: 'é’¢é“é•¿å‰‘',
              type: 'æ­¦å™¨',
              count: 1,
              description: 'é”‹åˆ©çš„é’¢é“é•¿å‰‘ï¼Œæ˜¯æˆ˜å£«ä»¬çš„å¯é ä¼™ä¼´ï¼Œèƒ½å¤Ÿé€ æˆå·¨å¤§çš„ç‰©ç†ä¼¤å®³',
            },
            {
              name: 'æ³•åŠ›æ°´æ™¶',
              type: 'è¯æ°´',
              count: 15,
              description: 'çº¯å‡€çš„æ³•åŠ›æ°´æ™¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ¢å¤é­”æ³•å€¼ï¼Œæ˜¯æ³•å¸ˆèŒä¸šçš„é‡è¦è¡¥ç»™å“',
            },
            {
              name: 'é¾™é³ç›¾ç‰Œ',
              type: 'é˜²å…·',
              count: 1,
              description: 'ç”±çœŸé¾™é³ç‰‡æ‰“é€ çš„ä¼ å¥‡ç›¾ç‰Œï¼Œæ‹¥æœ‰æå¼ºçš„é˜²å¾¡åŠ›å’Œé­”æ³•æŠ—æ€§',
            },
            {
              name: 'å‡¤å‡°ç¾½æ¯›',
              type: 'ææ–™',
              count: 2,
              description: 'ä¼ è¯´ä¸­å‡¤å‡°çš„ç¾½æ¯›ï¼Œè•´å«é‡ç”Ÿä¹‹åŠ›ï¼Œæ˜¯ç‚¼åˆ¶å¤æ´»è¯å‰‚çš„æ ¸å¿ƒææ–™',
            },
            {
              name: 'æ™ºæ…§ä¹‹ä¹¦',
              type: 'ä¹¦ç±',
              count: 1,
              description: 'è®°å½•ç€å¤è€æ™ºæ…§çš„ç¥ç§˜ä¹¦ç±ï¼Œé˜…è¯»åèƒ½å¤Ÿæ°¸ä¹…æå‡æ™ºåŠ›å±æ€§',
            },
            {
              name: 'ç«ç„°æ³•æ–',
              type: 'æ³•æ–',
              count: 1,
              description: 'è•´å«ç«ç„°é­”æ³•çš„å¼ºå¤§æ³•æ–ï¼Œèƒ½å¤Ÿé‡Šæ”¾æ¯ç­æ€§çš„ç«çƒæœ¯',
            },
            {
              name: 'æ²»ç–—è¯å‰‚',
              type: 'è¯å‰‚',
              count: 20,
              description: 'å¿«é€Ÿæ¢å¤ä¼¤åŠ¿çš„æ²»ç–—è¯å‰‚ï¼Œå†’é™©è€…çš„å¿…å¤‡è¡¥ç»™å“',
            },
            {
              name: 'ç§˜é“¶çŸ¿çŸ³',
              type: 'çŸ¿çŸ³',
              count: 8,
              description: 'ç¨€æœ‰çš„ç§˜é“¶çŸ¿çŸ³ï¼Œæ˜¯åˆ¶ä½œé«˜çº§è£…å¤‡çš„çè´µææ–™',
            },
            {
              name: 'éšèº«æ–—ç¯·',
              type: 'æ–—ç¯·',
              count: 1,
              description: 'ç¥å¥‡çš„éšèº«æ–—ç¯·ï¼Œç©¿ä¸Šåå¯ä»¥çŸ­æš‚éšèº«ï¼Œé¿å¼€æ•Œäººçš„è§†çº¿',
            },
            {
              name: 'é­”æ³•ç¬¦æ–‡',
              type: 'ç¬¦æ–‡',
              count: 5,
              description: 'åˆ»æœ‰å¤è€é­”æ³•çš„ç¬¦æ–‡çŸ³ï¼Œå¯ä»¥ç”¨æ¥å¼ºåŒ–æ­¦å™¨å’Œè£…å¤‡',
            },
          ];
        },

        // æå–ç‰©å“ä½¿ç”¨è®°å½•ï¼ˆæ¨¡æ‹Ÿï¼‰
        extractItemUsageData: async function () {
          // æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®åŠ è½½
          await new Promise(resolve => setTimeout(resolve, 300));

          // æ¨¡æ‹Ÿä»DOMæ‰«æç‰©å“ä½¿ç”¨è®°å½•
          const usageRecords = [];
          const usageSummary = {};

          // æ‰«æé¡µé¢ä¸­çš„æ¨¡æ‹Ÿä½¿ç”¨è®°å½•
          const $messageElements = $('body').find('.mes_text, .test-message');

          $messageElements.each(function () {
            const messageText = $(this).text();

            // æŸ¥æ‰¾ç‰©å“ä½¿ç”¨æ ‡è®°æ ¼å¼: [ç‰©å“ä½¿ç”¨|ç‰©å“åç§°:xxx|ä½¿ç”¨æ•°é‡:x]
            const usageRegex = /\[ç‰©å“ä½¿ç”¨\|ç‰©å“åç§°:(.*?)\|ä½¿ç”¨æ•°é‡:(\d+)\]/g;
            let usageMatch;
            while ((usageMatch = usageRegex.exec(messageText)) !== null) {
              const itemName = usageMatch[1].trim();
              const quantity = parseInt(usageMatch[2]) || 1;

              const record = {
                itemName: itemName,
                quantity: quantity,
                timestamp: new Date().toISOString(),
              };

              usageRecords.push(record);

              // æ±‡æ€»ä½¿ç”¨æ•°é‡
              if (!usageSummary[itemName]) {
                usageSummary[itemName] = {
                  itemName: itemName,
                  totalUsed: 0,
                  usageHistory: [],
                };
              }
              usageSummary[itemName].totalUsed += quantity;
              usageSummary[itemName].usageHistory.push(record);
            }
          });

          console.log(
            `ğŸ“Š æ¨¡æ‹Ÿç‰©å“ä½¿ç”¨æ•°æ®: æ‰¾åˆ°${usageRecords.length}æ¡ä½¿ç”¨è®°å½•ï¼Œæ¶‰åŠ${Object.keys(usageSummary).length}ç§ç‰©å“`,
          );

          return {
            all: usageRecords,
            summary: usageSummary,
          };
        },
      };
    </script>

    <!-- åŠ è½½åº”ç”¨è„šæœ¬ -->
    <script src="apps/phone-shell.js"></script>
    <script src="apps/phone-interface.js"></script>
    <script src="apps/backpack-app.js"></script>

    <script>
      $(document).ready(function () {
        // åˆå§‹åŒ–phone-shellç³»ç»Ÿ
        if (window.PhoneShell) {
          window.PhoneShell.init();
        }

        // åˆå§‹åŒ–æ‰‹æœºç•Œé¢ï¼ˆä»…æŒ‰é’®æ¨¡å¼ï¼‰
        if (window.PhoneInterface) {
          window.PhoneInterface.initButtonOnly();
        }

        // åˆå§‹åŒ–èƒŒåŒ…åº”ç”¨
        if (window.BackpackApp) {
          window.BackpackApp.init();
        }

        // æµ‹è¯•æŒ‰é’®äº‹ä»¶
        $('#test-backpack-btn').on('click', function () {
          console.log('æµ‹è¯•èƒŒåŒ…åº”ç”¨...');
          if (window.BackpackApp) {
            window.BackpackApp.show();
          } else {
            alert('èƒŒåŒ…åº”ç”¨æœªåŠ è½½');
          }
        });

        $('#test-phone-btn').on('click', function () {
          console.log('æ˜¾ç¤ºæ‰‹æœºç•Œé¢...');
          if (window.PhoneInterface) {
            // å¦‚æœç•Œé¢ä¸å­˜åœ¨ï¼Œå…ˆåˆ›å»º
            if ($('#phone_interface').length === 0) {
              window.PhoneInterface.createInterfaceAndShow();
            } else {
              window.PhoneInterface.show();
            }
          } else {
            alert('æ‰‹æœºç•Œé¢æœªåŠ è½½');
          }
        });
      });
    </script>
  </body>
</html>
