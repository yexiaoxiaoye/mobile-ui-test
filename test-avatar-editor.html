<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QQ头像编辑器测试</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="styles/qq-avatar-editor.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        
        .test-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .test-btn {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
        
        .phone-simulator {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 50px;
            padding: 10px;
            margin: 20px auto;
            position: relative;
        }
        
        .phone-screen {
            width: 100%;
            height: 100%;
            background: #fff;
            border-radius: 40px;
            overflow: hidden;
            position: relative;
        }
        
        .qq-app-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>QQ头像编辑器测试</h1>
        <p>点击下面的按钮测试头像编辑器功能：</p>
        
        <button class="test-btn" id="test-user-editor">测试用户头像编辑器</button>
        <button class="test-btn" id="test-contact-editor">测试联系人头像编辑器</button>
        <button class="test-btn" id="test-in-phone">在手机界面中测试</button>
        
        <div id="console-output" style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
            <strong>控制台输出：</strong><br>
        </div>
    </div>
    
    <!-- 手机模拟器 -->
    <div class="phone-simulator" id="phone_interface" style="display: none;">
        <div class="phone-screen">
            <div class="qq-app-container"></div>
        </div>
    </div>

    <!-- 模拟QQ应用对象 -->
    <script>
        // 模拟QQ应用对象
        window.QQApp = {
            userData: {
                name: '测试用户',
                avatar: 'https://files.catbox.moe/9gz3v2.jpg'
            },
            
            getAvatarUrl: function(qqNumber) {
                return 'https://files.catbox.moe/9gz3v2.jpg';
            },
            
            setUserDataEnhanced: function(name, avatarConfig) {
                console.log('保存用户数据:', name, avatarConfig);
                this.userData.name = name;
                if (typeof avatarConfig === 'string') {
                    this.userData.avatar = avatarConfig;
                } else if (avatarConfig && avatarConfig.url) {
                    this.userData.avatar = avatarConfig.url;
                }
                logToConsole('✅ 用户头像已保存: ' + JSON.stringify(avatarConfig));
            },
            
            setAvatarUrlEnhanced: function(qqNumber, avatarConfig) {
                console.log('保存联系人头像:', qqNumber, avatarConfig);
                logToConsole('✅ 联系人头像已保存: QQ' + qqNumber + ' - ' + JSON.stringify(avatarConfig));
            },
            
            showMainInterface: function() {
                console.log('显示QQ主界面');
                logToConsole('🏠 返回QQ主界面');
            }
        };
        
        // 控制台输出函数
        function logToConsole(message) {
            const output = document.getElementById('console-output');
            const time = new Date().toLocaleTimeString();
            output.innerHTML += `<br>[${time}] ${message}`;
            output.scrollTop = output.scrollHeight;
        }
        
        // 重写console.log来显示在页面上
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToConsole(args.join(' '));
        };
    </script>

    <!-- 加载头像编辑器 -->
    <script src="apps/qq-avatar-editor.js"></script>

    <script>
        $(document).ready(function() {
            logToConsole('页面加载完成');
            
            // 测试用户头像编辑器
            $('#test-user-editor').click(function() {
                logToConsole('🎨 测试用户头像编辑器');
                if (window.QQAvatarEditor) {
                    window.QQAvatarEditor.showUserEditor();
                } else {
                    logToConsole('❌ QQAvatarEditor 不可用');
                }
            });
            
            // 测试联系人头像编辑器
            $('#test-contact-editor').click(function() {
                logToConsole('🎨 测试联系人头像编辑器');
                if (window.QQAvatarEditor) {
                    window.QQAvatarEditor.showContactEditor('123456789', '测试联系人');
                } else {
                    logToConsole('❌ QQAvatarEditor 不可用');
                }
            });
            
            // 在手机界面中测试
            $('#test-in-phone').click(function() {
                logToConsole('📱 在手机界面中测试');
                $('#phone_interface').show();
                $('#phone_interface').addClass('show-qq-app-content');
                
                setTimeout(() => {
                    if (window.QQAvatarEditor) {
                        window.QQAvatarEditor.showUserEditor();
                    }
                }, 500);
            });
            
            // 检查QQAvatarEditor是否加载
            setTimeout(() => {
                if (window.QQAvatarEditor) {
                    logToConsole('✅ QQAvatarEditor 已加载');
                } else {
                    logToConsole('❌ QQAvatarEditor 未加载');
                }
            }, 1000);
        });
    </script>
</body>
</html>
