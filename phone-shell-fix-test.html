<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>📱 手机外壳修复测试</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="styles/phone-shell.css" />
    <link rel="stylesheet" href="styles/phone-interface.css" />
    <style>
      body {
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .test-controls {
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .test-btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        margin: 5px;
        cursor: pointer;
        font-size: 14px;
      }

      .test-btn:hover {
        background: #0056b3;
      }

      .status-display {
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
        font-family: monospace;
        font-size: 12px;
        max-width: 600px;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <div class="test-controls">
      <h2>📱 手机外壳背景修复测试</h2>
      <p>测试phone-shell系统与wallpaper应用的集成</p>

      <button class="test-btn" onclick="createPhoneInterface()">创建手机界面</button>
      <button class="test-btn" onclick="testWallpaperApplication()">测试壁纸应用</button>
      <button class="test-btn" onclick="showPhoneInterface()">显示手机</button>
      <button class="test-btn" onclick="hidePhoneInterface()">隐藏手机</button>
      <button class="test-btn" onclick="checkElements()">检查元素</button>
      <button class="test-btn" onclick="clearAll()">清除所有</button>
    </div>

    <div class="status-display" id="status">等待测试...</div>

    <script src="apps/phone-shell.js"></script>
    <script src="apps/wallpaper-app.js"></script>
    <script>
      let statusEl = document.getElementById('status');

      function log(message) {
        console.log(message);
        statusEl.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
        statusEl.scrollTop = statusEl.scrollHeight;
      }

      function createPhoneInterface() {
        log('🏗️ 开始创建手机界面...');

        // 初始化phone-shell系统
        if (typeof window.PhoneShell === 'undefined') {
          log('❌ PhoneShell系统未找到');
          return;
        }

        window.PhoneShell.init();
        log('✅ PhoneShell系统已初始化');

        // 创建测试内容
        const testContent = `
                <div class="phone-screen">
                    <div class="phone-background"></div>
                    <div class="phone-home-screen">
                        <div class="home-time">
                            <div class="home-time-main">21:09</div>
                            <div class="home-time-date">测试模式</div>
                        </div>
                        <div style="text-align: center; margin-top: 100px; color: white;">
                            <h3>📱 手机界面测试</h3>
                            <p>背景应该正确显示</p>
                        </div>
                    </div>
                </div>
            `;

        // 创建手机外壳
        const phoneHTML = window.PhoneShell.createShellHTML(testContent, 'test_phone');
        $('body').append(phoneHTML);

        log('✅ 手机界面HTML已创建');
      }

      function testWallpaperApplication() {
        log('🎨 测试壁纸应用...');

        if (typeof window.WallpaperApp === 'undefined') {
          log('❌ WallpaperApp未找到');
          return;
        }

        // 初始化壁纸应用
        window.WallpaperApp.init();
        log('✅ WallpaperApp已初始化');

        // 测试壁纸应用
        const testWallpaper = 'https://files.catbox.moe/wh4joi.jpg';
        window.WallpaperApp.updatePhoneBackground(testWallpaper);
        log('🖼️ 测试壁纸已应用: ' + testWallpaper);

        // 测试默认壁纸应用
        setTimeout(() => {
          log('🔄 测试默认壁纸应用...');
          window.WallpaperApp.applyCurrentWallpaper();
          log('✅ 默认壁纸应用完成');
        }, 2000);
      }

      function showPhoneInterface() {
        log('📱 显示手机界面...');
        if (window.PhoneShell) {
          window.PhoneShell.show('test_phone');
          log('✅ 手机界面已显示');
        } else {
          log('❌ PhoneShell系统未找到');
        }
      }

      function hidePhoneInterface() {
        log('🙈 隐藏手机界面...');
        if (window.PhoneShell) {
          window.PhoneShell.hide('test_phone');
          log('✅ 手机界面已隐藏');
        } else {
          log('❌ PhoneShell系统未找到');
        }
      }

      function checkElements() {
        log('🔍 检查页面元素...');

        const phoneShell = $('#test_phone');
        const phoneScreen = $('.phone-screen');
        const phoneBackground = $('.phone-background');

        log('📊 元素检查结果:');
        log('  - phone-shell: ' + (phoneShell.length > 0 ? '✅ 存在' : '❌ 不存在'));
        log('  - phone-screen: ' + (phoneScreen.length > 0 ? '✅ 存在' : '❌ 不存在'));
        log('  - phone-background: ' + (phoneBackground.length > 0 ? '✅ 存在' : '❌ 不存在'));

        if (phoneScreen.length > 0) {
          const bgImage = phoneScreen.css('background-image');
          log('  - 背景图片: ' + (bgImage && bgImage !== 'none' ? '✅ 已设置' : '❌ 未设置'));
          log('    背景值: ' + bgImage);
        }
      }

      function clearAll() {
        log('🧹 清除所有元素...');
        $('.phone-shell').remove();
        $('#test_phone').remove();
        log('✅ 所有元素已清除');
      }

      // 页面加载完成后的初始化
      $(document).ready(function () {
        log('🚀 测试页面已加载');
        log('📋 可用的测试功能:');
        log('  1. 创建手机界面 - 创建基本的手机外壳结构');
        log('  2. 测试壁纸应用 - 应用测试壁纸');
        log('  3. 显示/隐藏手机 - 控制手机界面显示');
        log('  4. 检查元素 - 验证DOM结构和样式');
        log('  5. 清除所有 - 重置测试环境');
      });
    </script>
  </body>
</html>
