<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QQ背景功能测试</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/phone-interface.css">
    <link rel="stylesheet" href="styles/qq-app.css">
    <link rel="stylesheet" href="styles/wallpaper-app.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f0f0;
        }
        .test-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .test-info {
            padding: 20px;
            background: #007bff;
            color: white;
            text-align: center;
        }
        .test-info h1 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }
        .test-info p {
            margin: 0;
            opacity: 0.9;
        }
        .debug-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            max-width: 300px;
            z-index: 9999;
        }
        .debug-panel h3 {
            margin: 0 0 10px 0;
            color: #4CAF50;
        }
        .debug-panel .status {
            margin: 5px 0;
        }
        .debug-panel .status.success {
            color: #4CAF50;
        }
        .debug-panel .status.error {
            color: #f44336;
        }
        .debug-panel .status.warning {
            color: #ff9800;
        }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h3>🔧 调试面板</h3>
        <div class="status" id="wallpaper-app-status">WallpaperApp: 检查中...</div>
        <div class="status" id="qq-app-status">QQApp: 检查中...</div>
        <div class="status" id="buttons-status">调色盘按钮: 检查中...</div>
        <div class="status" id="events-status">事件绑定: 检查中...</div>
    </div>

    <div class="test-container">
        <div class="test-info">
            <h1>🎨 QQ背景功能测试</h1>
            <p>测试调色盘按钮显示和功能</p>
        </div>
        
        <!-- 手机界面容器 -->
        <div id="phone_interface" class="show-qq-app-content">
            <!-- QQ应用容器 -->
            <div class="qq-app-container">
                <!-- 这里会被QQ应用内容填充 -->
            </div>
        </div>
    </div>

    <!-- 原始QQ对话框（隐藏，用于克隆） -->
    <div id="chat_history_dialog" style="display: none;">
        <div>
            <div class="dialog-head">
                <div class="user-info-section">
                    <div class="user-avatar-wrapper">
                        <div class="user-avatar" id="user_avatar" title="点击设置用户头像">
                            用户
                        </div>
                    </div>
                    <div class="user-details">
                        <h3 id="user_name">测试用户</h3>
                        <div><span class="hgd-show"></span></div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button id="create_group_btn">+</button>
                    <button class="wallpaper-btn" id="qq_home_wallpaper_btn" title="设置QQ主页背景">🎨</button>
                    <button class="home-btn" id="home_btn_main" title="返回手机首页">🏠︎</button>
                </div>
            </div>
            <div id="history_content" style="flex-grow: 1; overflow-y: auto; padding: 15px;">
                <!-- 测试联系人 -->
                <div class="qq-contact-wrapper" data-qq-number="123456789">
                    <div class="contact-summary">
                        <div class="contact-avatar-wrapper">
                            <div class="custom-avatar" style="background: #666; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px;">
                                测
                            </div>
                        </div>
                        <div class="contact-info">
                            <div class="contact-name">
                                <span class="contact-name-text">测试联系人</span>
                                <span class="contact-time">12:34</span>
                            </div>
                            <div class="last-message">这是一条测试消息</div>
                        </div>
                    </div>
                    
                    <!-- 隐藏的聊天页面 -->
                    <div class="chat-page">
                        <div class="chat-header">
                            <button class="back-to-main-list-btn">←</button>
                            <div class="chat-title">
                                <div>测试联系人</div>
                                <div class="contact-status-qq">QQ: 123456789</div>
                            </div>
                            <button class="chat-wallpaper-btn" data-chat-id="123456789" title="设置聊天背景">🎨</button>
                            <button class="home-btn chat-home-btn" title="返回手机首页">🏠︎</button>
                        </div>
                        <div class="chat-messages">
                            <div class="custom-message custom-received">
                                <div class="message-avatar" style="background: #666; color: white;">测</div>
                                <div class="message-bubble">
                                    <div>你好！这是一条测试消息。</div>
                                    <div class="message-time">12:34</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 美化应用对话框 -->
    <div id="wallpaper_dialog" style="display: none;">
        <div class="wallpaper-container">
            <div class="wallpaper-header">
                <h3 id="wallpaper_title">美化应用</h3>
                <button class="wallpaper-close-btn">×</button>
            </div>
            <div class="wallpaper-content">
                <div class="wallpaper-input-section">
                    <label for="wallpaper_url_input">壁纸URL:</label>
                    <input type="text" id="wallpaper_url_input" class="wallpaper-url-input" placeholder="输入图片URL">
                </div>
                <div class="wallpaper-blur-section" style="display: none;">
                    <label for="wallpaper_blur_slider">模糊程度:</label>
                    <input type="range" id="wallpaper_blur_slider" class="wallpaper-blur-slider" min="0" max="20" value="0">
                    <span class="blur-value">0px</span>
                </div>
                <div class="wallpaper-actions">
                    <button class="wallpaper-apply-btn">应用</button>
                    <button class="wallpaper-reset-btn">重置</button>
                    <button class="wallpaper-export-btn">📁 导出配置</button>
                    <input type="file" class="wallpaper-import-input" accept=".json" style="display: none;">
                    <button class="wallpaper-import-btn">📂 导入配置</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入必要的脚本 -->
    <script src="jquery-3.js"></script>
    <script src="apps/wallpaper-app.js"></script>
    <script src="apps/qq-data-manager.js"></script>
    <script src="apps/data-extractor.js"></script>
    <script src="apps/qq-app.js"></script>

    <script>
        // 调试和测试脚本
        $(document).ready(function() {
            console.log('🚀 QQ背景功能测试页面加载完成');
            
            // 检查应用状态
            function checkAppStatus() {
                // 检查WallpaperApp
                if (window.WallpaperApp) {
                    $('#wallpaper-app-status').removeClass('error warning').addClass('success').text('WallpaperApp: ✅ 已加载');
                } else {
                    $('#wallpaper-app-status').removeClass('success warning').addClass('error').text('WallpaperApp: ❌ 未加载');
                }
                
                // 检查QQApp
                if (window.QQApp) {
                    $('#qq-app-status').removeClass('error warning').addClass('success').text('QQApp: ✅ 已加载');
                } else {
                    $('#qq-app-status').removeClass('success warning').addClass('error').text('QQApp: ❌ 未加载');
                }
                
                // 检查调色盘按钮
                const homeBtn = $('#qq_home_wallpaper_btn');
                const chatBtn = $('.chat-wallpaper-btn');
                if (homeBtn.length > 0 && chatBtn.length > 0) {
                    $('#buttons-status').removeClass('error warning').addClass('success').text('调色盘按钮: ✅ 已找到 (' + (homeBtn.length + chatBtn.length) + '个)');
                } else {
                    $('#buttons-status').removeClass('success warning').addClass('warning').text('调色盘按钮: ⚠️ 部分缺失 (主页:' + homeBtn.length + ', 聊天:' + chatBtn.length + ')');
                }
                
                // 检查事件绑定
                const events = $._data(document, 'events');
                if (events && events.click) {
                    const wallpaperEvents = events.click.filter(e => 
                        e.selector && (e.selector.includes('wallpaper-btn') || e.selector.includes('#qq_home_wallpaper_btn'))
                    );
                    if (wallpaperEvents.length > 0) {
                        $('#events-status').removeClass('error warning').addClass('success').text('事件绑定: ✅ 已绑定 (' + wallpaperEvents.length + '个)');
                    } else {
                        $('#events-status').removeClass('success warning').addClass('warning').text('事件绑定: ⚠️ 未找到壁纸相关事件');
                    }
                } else {
                    $('#events-status').removeClass('success warning').addClass('error').text('事件绑定: ❌ 无事件系统');
                }
            }
            
            // 初始化应用
            setTimeout(function() {
                if (window.WallpaperApp && typeof window.WallpaperApp.init === 'function') {
                    window.WallpaperApp.init();
                    console.log('✅ WallpaperApp 已初始化');
                }
                
                if (window.QQApp && typeof window.QQApp.show === 'function') {
                    window.QQApp.show();
                    console.log('✅ QQApp 已显示');
                }
                
                checkAppStatus();
            }, 500);
            
            // 定期检查状态
            setInterval(checkAppStatus, 2000);
            
            // 测试按钮点击
            $(document).on('click', '.wallpaper-btn, .chat-wallpaper-btn', function(e) {
                console.log('🎨 调色盘按钮被点击:', this.id || this.className, $(this).data());
            });
        });
    </script>
</body>
</html>
