<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QQèƒŒæ™¯åŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/phone-interface.css">
    <link rel="stylesheet" href="styles/qq-app.css">
    <link rel="stylesheet" href="styles/wallpaper-app.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f0f0;
        }
        .test-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .test-info {
            padding: 20px;
            background: #007bff;
            color: white;
            text-align: center;
        }
        .test-info h1 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }
        .test-info p {
            margin: 0;
            opacity: 0.9;
        }
        .debug-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            max-width: 300px;
            z-index: 9999;
        }
        .debug-panel h3 {
            margin: 0 0 10px 0;
            color: #4CAF50;
        }
        .debug-panel .status {
            margin: 5px 0;
        }
        .debug-panel .status.success {
            color: #4CAF50;
        }
        .debug-panel .status.error {
            color: #f44336;
        }
        .debug-panel .status.warning {
            color: #ff9800;
        }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h3>ğŸ”§ è°ƒè¯•é¢æ¿</h3>
        <div class="status" id="wallpaper-app-status">WallpaperApp: æ£€æŸ¥ä¸­...</div>
        <div class="status" id="qq-app-status">QQApp: æ£€æŸ¥ä¸­...</div>
        <div class="status" id="buttons-status">è°ƒè‰²ç›˜æŒ‰é’®: æ£€æŸ¥ä¸­...</div>
        <div class="status" id="events-status">äº‹ä»¶ç»‘å®š: æ£€æŸ¥ä¸­...</div>
    </div>

    <div class="test-container">
        <div class="test-info">
            <h1>ğŸ¨ QQèƒŒæ™¯åŠŸèƒ½æµ‹è¯•</h1>
            <p>æµ‹è¯•è°ƒè‰²ç›˜æŒ‰é’®æ˜¾ç¤ºå’ŒåŠŸèƒ½</p>
        </div>
        
        <!-- æ‰‹æœºç•Œé¢å®¹å™¨ -->
        <div id="phone_interface" class="show-qq-app-content">
            <!-- QQåº”ç”¨å®¹å™¨ -->
            <div class="qq-app-container">
                <!-- è¿™é‡Œä¼šè¢«QQåº”ç”¨å†…å®¹å¡«å…… -->
            </div>
        </div>
    </div>

    <!-- åŸå§‹QQå¯¹è¯æ¡†ï¼ˆéšè—ï¼Œç”¨äºå…‹éš†ï¼‰ -->
    <div id="chat_history_dialog" style="display: none;">
        <div>
            <div class="dialog-head">
                <div class="user-info-section">
                    <div class="user-avatar-wrapper">
                        <div class="user-avatar" id="user_avatar" title="ç‚¹å‡»è®¾ç½®ç”¨æˆ·å¤´åƒ">
                            ç”¨æˆ·
                        </div>
                    </div>
                    <div class="user-details">
                        <h3 id="user_name">æµ‹è¯•ç”¨æˆ·</h3>
                        <div><span class="hgd-show"></span></div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button id="create_group_btn">+</button>
                    <button class="wallpaper-btn" id="qq_home_wallpaper_btn" title="è®¾ç½®QQä¸»é¡µèƒŒæ™¯">ğŸ¨</button>
                    <button class="home-btn" id="home_btn_main" title="è¿”å›æ‰‹æœºé¦–é¡µ">ğŸ ï¸</button>
                </div>
            </div>
            <div id="history_content" style="flex-grow: 1; overflow-y: auto; padding: 15px;">
                <!-- æµ‹è¯•è”ç³»äºº -->
                <div class="qq-contact-wrapper" data-qq-number="123456789">
                    <div class="contact-summary">
                        <div class="contact-avatar-wrapper">
                            <div class="custom-avatar" style="background: #666; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px;">
                                æµ‹
                            </div>
                        </div>
                        <div class="contact-info">
                            <div class="contact-name">
                                <span class="contact-name-text">æµ‹è¯•è”ç³»äºº</span>
                                <span class="contact-time">12:34</span>
                            </div>
                            <div class="last-message">è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯</div>
                        </div>
                    </div>
                    
                    <!-- éšè—çš„èŠå¤©é¡µé¢ -->
                    <div class="chat-page">
                        <div class="chat-header">
                            <button class="back-to-main-list-btn">â†</button>
                            <div class="chat-title">
                                <div>æµ‹è¯•è”ç³»äºº</div>
                                <div class="contact-status-qq">QQ: 123456789</div>
                            </div>
                            <button class="chat-wallpaper-btn" data-chat-id="123456789" title="è®¾ç½®èŠå¤©èƒŒæ™¯">ğŸ¨</button>
                            <button class="home-btn chat-home-btn" title="è¿”å›æ‰‹æœºé¦–é¡µ">ğŸ ï¸</button>
                        </div>
                        <div class="chat-messages">
                            <div class="custom-message custom-received">
                                <div class="message-avatar" style="background: #666; color: white;">æµ‹</div>
                                <div class="message-bubble">
                                    <div>ä½ å¥½ï¼è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯ã€‚</div>
                                    <div class="message-time">12:34</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¾åŒ–åº”ç”¨å¯¹è¯æ¡† -->
    <div id="wallpaper_dialog" style="display: none;">
        <div class="wallpaper-container">
            <div class="wallpaper-header">
                <h3 id="wallpaper_title">ç¾åŒ–åº”ç”¨</h3>
                <button class="wallpaper-close-btn">Ã—</button>
            </div>
            <div class="wallpaper-content">
                <div class="wallpaper-input-section">
                    <label for="wallpaper_url_input">å£çº¸URL:</label>
                    <input type="text" id="wallpaper_url_input" class="wallpaper-url-input" placeholder="è¾“å…¥å›¾ç‰‡URL">
                </div>
                <div class="wallpaper-blur-section" style="display: none;">
                    <label for="wallpaper_blur_slider">æ¨¡ç³Šç¨‹åº¦:</label>
                    <input type="range" id="wallpaper_blur_slider" class="wallpaper-blur-slider" min="0" max="20" value="0">
                    <span class="blur-value">0px</span>
                </div>
                <div class="wallpaper-actions">
                    <button class="wallpaper-apply-btn">åº”ç”¨</button>
                    <button class="wallpaper-reset-btn">é‡ç½®</button>
                    <button class="wallpaper-export-btn">ğŸ“ å¯¼å‡ºé…ç½®</button>
                    <input type="file" class="wallpaper-import-input" accept=".json" style="display: none;">
                    <button class="wallpaper-import-btn">ğŸ“‚ å¯¼å…¥é…ç½®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="jquery-3.js"></script>
    <script src="apps/wallpaper-app.js"></script>
    <script src="apps/qq-data-manager.js"></script>
    <script src="apps/data-extractor.js"></script>
    <script src="apps/qq-app.js"></script>

    <script>
        // è°ƒè¯•å’Œæµ‹è¯•è„šæœ¬
        $(document).ready(function() {
            console.log('ğŸš€ QQèƒŒæ™¯åŠŸèƒ½æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // æ£€æŸ¥åº”ç”¨çŠ¶æ€
            function checkAppStatus() {
                // æ£€æŸ¥WallpaperApp
                if (window.WallpaperApp) {
                    $('#wallpaper-app-status').removeClass('error warning').addClass('success').text('WallpaperApp: âœ… å·²åŠ è½½');
                } else {
                    $('#wallpaper-app-status').removeClass('success warning').addClass('error').text('WallpaperApp: âŒ æœªåŠ è½½');
                }
                
                // æ£€æŸ¥QQApp
                if (window.QQApp) {
                    $('#qq-app-status').removeClass('error warning').addClass('success').text('QQApp: âœ… å·²åŠ è½½');
                } else {
                    $('#qq-app-status').removeClass('success warning').addClass('error').text('QQApp: âŒ æœªåŠ è½½');
                }
                
                // æ£€æŸ¥è°ƒè‰²ç›˜æŒ‰é’®
                const homeBtn = $('#qq_home_wallpaper_btn');
                const chatBtn = $('.chat-wallpaper-btn');
                if (homeBtn.length > 0 && chatBtn.length > 0) {
                    $('#buttons-status').removeClass('error warning').addClass('success').text('è°ƒè‰²ç›˜æŒ‰é’®: âœ… å·²æ‰¾åˆ° (' + (homeBtn.length + chatBtn.length) + 'ä¸ª)');
                } else {
                    $('#buttons-status').removeClass('success warning').addClass('warning').text('è°ƒè‰²ç›˜æŒ‰é’®: âš ï¸ éƒ¨åˆ†ç¼ºå¤± (ä¸»é¡µ:' + homeBtn.length + ', èŠå¤©:' + chatBtn.length + ')');
                }
                
                // æ£€æŸ¥äº‹ä»¶ç»‘å®š
                const events = $._data(document, 'events');
                if (events && events.click) {
                    const wallpaperEvents = events.click.filter(e => 
                        e.selector && (e.selector.includes('wallpaper-btn') || e.selector.includes('#qq_home_wallpaper_btn'))
                    );
                    if (wallpaperEvents.length > 0) {
                        $('#events-status').removeClass('error warning').addClass('success').text('äº‹ä»¶ç»‘å®š: âœ… å·²ç»‘å®š (' + wallpaperEvents.length + 'ä¸ª)');
                    } else {
                        $('#events-status').removeClass('success warning').addClass('warning').text('äº‹ä»¶ç»‘å®š: âš ï¸ æœªæ‰¾åˆ°å£çº¸ç›¸å…³äº‹ä»¶');
                    }
                } else {
                    $('#events-status').removeClass('success warning').addClass('error').text('äº‹ä»¶ç»‘å®š: âŒ æ— äº‹ä»¶ç³»ç»Ÿ');
                }
            }
            
            // åˆå§‹åŒ–åº”ç”¨
            setTimeout(function() {
                if (window.WallpaperApp && typeof window.WallpaperApp.init === 'function') {
                    window.WallpaperApp.init();
                    console.log('âœ… WallpaperApp å·²åˆå§‹åŒ–');
                }
                
                if (window.QQApp && typeof window.QQApp.show === 'function') {
                    window.QQApp.show();
                    console.log('âœ… QQApp å·²æ˜¾ç¤º');
                }
                
                checkAppStatus();
            }, 500);
            
            // å®šæœŸæ£€æŸ¥çŠ¶æ€
            setInterval(checkAppStatus, 2000);
            
            // æµ‹è¯•æŒ‰é’®ç‚¹å‡»
            $(document).on('click', '.wallpaper-btn, .chat-wallpaper-btn', function(e) {
                console.log('ğŸ¨ è°ƒè‰²ç›˜æŒ‰é’®è¢«ç‚¹å‡»:', this.id || this.className, $(this).data());
            });
        });
    </script>
</body>
</html>
