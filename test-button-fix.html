<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QQå¤´åƒç¼–è¾‘å™¨æŒ‰é’®ä¿®å¤æµ‹è¯•</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="styles/qq-avatar-editor.css" />
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #f0f0f0;
      }

      .test-container {
        max-width: 400px;
        margin: 0 auto;
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .test-btn {
        width: 100%;
        padding: 12px;
        margin: 10px 0;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
      }

      .test-btn:hover {
        background: #0056b3;
      }

      /* æ¨¡æ‹Ÿæ‰‹æœºç•Œé¢å®¹å™¨ */
      .qq-app-container {
        width: 360px;
        height: 640px;
        margin: 20px auto;
        border: 2px solid #333;
        border-radius: 20px;
        overflow: hidden;
        background: white;
        position: relative;
      }

      .status-info {
        margin-top: 20px;
        padding: 10px;
        background: #e9ecef;
        border-radius: 6px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>QQå¤´åƒç¼–è¾‘å™¨æŒ‰é’®ä¿®å¤æµ‹è¯•</h1>
      <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•å¤´åƒç¼–è¾‘å™¨æŒ‰é’®åœ¨æ‰‹æœºç•Œé¢ä¸­çš„æ˜¾ç¤ºé—®é¢˜ä¿®å¤ã€‚</p>

      <button class="test-btn" onclick="testInMobileContainer()">åœ¨æ‰‹æœºå®¹å™¨ä¸­æµ‹è¯•å¤´åƒç¼–è¾‘å™¨</button>
      <button class="test-btn" onclick="testStandalone()">ç‹¬ç«‹æµ‹è¯•å¤´åƒç¼–è¾‘å™¨</button>
      <button class="test-btn" onclick="clearTest()">æ¸…é™¤æµ‹è¯•</button>

      <div class="status-info">
        <strong>æµ‹è¯•è¯´æ˜ï¼š</strong><br />
        1. ç‚¹å‡»"åœ¨æ‰‹æœºå®¹å™¨ä¸­æµ‹è¯•"åº”è¯¥æ˜¾ç¤ºæŒ‰é’®åœ¨é¡µé¢åº•éƒ¨<br />
        2. æŒ‰é’®åº”è¯¥æ˜¯å¤§å°ºå¯¸ï¼Œé€‚åˆæ‰‹æœºç•Œé¢è§¦æ‘¸<br />
        3. æŒ‰é’®åº”è¯¥å®Œå…¨å¯è§ï¼Œå›ºå®šåœ¨åº•éƒ¨<br />
        4. æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦ç»†ä¿¡æ¯<br />
        5. æ–°ç‰ˆæœ¬ï¼šæŒ‰é’®å·²ç§»è‡³é¡µé¢åº•éƒ¨ï¼Œé¿å…è¢«é¡¶éƒ¨è¦†ç›–
      </div>
    </div>

    <!-- æ‰‹æœºç•Œé¢å®¹å™¨ -->
    <div class="qq-app-container" id="mobile-container" style="display: none">
      <!-- å¤´åƒç¼–è¾‘å™¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
    </div>

    <script src="apps/qq-avatar-editor.js"></script>
    <script>
      function testInMobileContainer() {
        console.log('ğŸ§ª å¼€å§‹æ‰‹æœºå®¹å™¨æµ‹è¯•');

        // æ˜¾ç¤ºæ‰‹æœºå®¹å™¨
        $('#mobile-container').show();

        // æ¨¡æ‹Ÿæ‰‹æœºç•Œé¢ç¯å¢ƒ
        const $container = $('#mobile-container');
        $container.addClass('qq-app-container');

        // åˆ›å»ºå¤´åƒç¼–è¾‘å™¨
        if (window.QQAvatarEditor) {
          // è®¾ç½®æµ‹è¯•æ•°æ®
          window.QQAvatarEditor.currentEditTarget = 'contact';
          window.QQAvatarEditor.currentContactInfo = {
            qqNumber: 123456789,
            contactName: 'æµ‹è¯•è”ç³»äºº',
          };

          // åˆ›å»ºç¼–è¾‘å™¨ç•Œé¢
          window.QQAvatarEditor.createEditorInterface();

          // å°†ç¼–è¾‘å™¨æ·»åŠ åˆ°æ‰‹æœºå®¹å™¨
          const $editor = $('.qq-avatar-editor-page').detach();
          $container.append($editor);
          $editor.show().css('display', 'flex');

          // ç¡®ä¿å¤´éƒ¨å¯è§
          window.QQAvatarEditor.ensureHeaderVisible($editor);

          console.log('âœ… æ‰‹æœºå®¹å™¨æµ‹è¯•å·²å¯åŠ¨');
        } else {
          console.error('âŒ QQAvatarEditor æœªåŠ è½½');
        }
      }

      function testStandalone() {
        console.log('ğŸ§ª å¼€å§‹ç‹¬ç«‹æµ‹è¯•');

        // éšè—æ‰‹æœºå®¹å™¨
        $('#mobile-container').hide();

        // åˆ›å»ºç‹¬ç«‹çš„å¤´åƒç¼–è¾‘å™¨
        if (window.QQAvatarEditor) {
          window.QQAvatarEditor.currentEditTarget = 'user';
          window.QQAvatarEditor.currentContactInfo = null;

          window.QQAvatarEditor.createEditorInterface();

          const $editor = $('.qq-avatar-editor-page');
          $('body').append($editor);
          $editor.show().css('display', 'flex');

          window.QQAvatarEditor.ensureHeaderVisible($editor);

          console.log('âœ… ç‹¬ç«‹æµ‹è¯•å·²å¯åŠ¨');
        } else {
          console.error('âŒ QQAvatarEditor æœªåŠ è½½');
        }
      }

      function clearTest() {
        console.log('ğŸ§¹ æ¸…é™¤æµ‹è¯•');
        $('.qq-avatar-editor-page').remove();
        $('#mobile-container').hide();
      }

      // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
      $(document).ready(function () {
        console.log('ğŸ“± æµ‹è¯•é¡µé¢å·²åŠ è½½');
        console.log('QQAvatarEditor å¯ç”¨:', typeof window.QQAvatarEditor !== 'undefined');
      });
    </script>
  </body>
</html>
